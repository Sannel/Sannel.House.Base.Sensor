trigger:
- master
- develop

pool:
  vmImage: 'ubuntu-latest'

variables:
  library_project: src/Sannel.House.Base.Sensor/Sannel.House.Base.Sensor.csproj
  library_project2: src/Sannel.House.Base.Sensor.MQTT/Sannel.House.Base.Sensor.MQTT.csproj
  support_netstandard20: true
  support_netstandard21: true
  support_netcoreapp21: true
  support_netcoreapp31: true
  support_net5_0: true

steps:
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '2.1.x'
    includePreviewVersions: false
  condition: eq(variables['support_netcoreapp21'], 'true')
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '3.1.x'
    includePreviewVersions: false
  condition: eq(variables['support_netcoreapp31'], 'true')
- task: UseDotNet@2
  inputs:
    packageType: 'sdk'
    version: '5.0.x'
    includePreviewVersions: true
  condition: eq(variables['support_net5_0'], 'true')
- template: build/tasks/build.yaml
  parameters:
    library_project: $library_project
- template: build/tasks/build.yaml
  parameters:
    library_project: $library_project2
- task: PublishPipelineArtifact@0
  displayName: 'Publish Pipeline Artifact'
  inputs:
    artifactName: 'packages-source'
    targetPath: '$(Build.StagingDirectory)'
